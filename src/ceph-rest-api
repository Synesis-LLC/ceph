#!/usr/bin/env python
# coding: utf-8

from __future__ import print_function

import argparse
import sys


try:
    import ceph_rest_api
except EnvironmentError as e:
    print("Error importing ceph_rest_api: ".format(e), file=sys.stderr)
    sys.exit(1)


def parse_args():
    parser = argparse.ArgumentParser(
        description="Ceph REST API webapp")
    parser.add_argument(
        '-c',
        '--conf',
        default='/etc/ceph/ceph.conf',
        help="Ceph configuration file",
    )
    parser.add_argument(
        '--cluster',
        help="Ceph cluster name",
    )
    parser.add_argument(
        '-n',
        '--name',
        help="Ceph client name",
    )
    parser.add_argument(
        '-i',
        '--id',
        default='admin',
        help="Ceph client id",
    )

    return parser.parse_known_args()


def main():
    parsed_args, rest = parse_args()

    app = ceph_rest_api.generate_app(
        parsed_args.conf,
        parsed_args.cluster,
        parsed_args.name,
        parsed_args.id,
        rest,
    )
    app.run(host=app.ceph_addr, port=app.ceph_port)


if __name__ == '__main__':
    main()
